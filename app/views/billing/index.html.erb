<%# Billing/Pricing Page - Shows subscription status or exemption %>

<s-page heading="Pricing">
  <s-link slot="breadcrumb-actions" href="<%= root_path(host: @host) %>">Dashboard</s-link>
</s-page>

<% if @shop.billing_exempt? %>
  <%# Billing Exempt Status %>
  <s-section heading="Account Status">
    <s-banner tone="success">
      <s-stack direction="block" gap="tight">
        <s-paragraph>
          <strong>Pricing Exempt</strong>
        </s-paragraph>
        <s-paragraph>
          Your account is exempt from billing charges. You have full access to all features.
        </s-paragraph>
      </s-stack>
    </s-banner>
  </s-section>

<% else %>
  <%# Subscription Information %>
  <s-section heading="Subscription">
    <s-stack direction="block" gap="base">
      <s-grid gridTemplateColumns="repeat(4, 1fr)" gap="base">
        <s-stack direction="block" gap="extra-tight">
          <s-paragraph>Status</s-paragraph>
          <s-badge tone="<%= @shop.subscription_status == 'active' ? 'success' : (@shop.subscription_status == 'trial' ? 'attention' : 'critical') %>">
            <%= @shop.subscription_status.capitalize %>
          </s-badge>
        </s-stack>

        <% if @subscription&.in_trial? %>
          <s-stack direction="block" gap="extra-tight">
            <s-paragraph>Trial Ends In</s-paragraph>
            <strong><%= @subscription.trial_days_remaining %> days</strong>
          </s-stack>

          <s-stack direction="block" gap="extra-tight">
            <s-paragraph>Trial Expiration</s-paragraph>
            <strong><%= @subscription.trial_ends_at.strftime("%b %d, %Y") %></strong>
          </s-stack>
        <% end %>

        <s-stack direction="block" gap="extra-tight">
          <s-paragraph>Price</s-paragraph>
          <strong>
            <% if @subscription %>
              $<%= @subscription.price.to_i %>/<%= @subscription.currency_code == 'USD' ? 'month' : @subscription.currency_code %>
            <% else %>
              $10/month
            <% end %>
          </strong>
        </s-stack>
      </s-grid>

      <% if @subscription&.in_trial? %>
        <s-banner tone="info">
          <s-paragraph>
            <strong>Trial Period:</strong> You're currently in your <%= @subscription.trial_days %>-day free trial.
            You'll be charged $<%= @subscription.price.to_i %>/month after your trial ends. Cancel anytime through your Shopify admin.
          </s-paragraph>
        </s-banner>
      <% elsif @shop.subscription_status == 'active' %>
        <s-banner tone="success">
          <s-paragraph>
            <strong>Active Subscription:</strong> Your subscription is active.
            <% if @subscription %>
              You're being charged $<%= @subscription.price.to_i %>/month.
            <% end %>
            Manage your subscription through your Shopify admin.
          </s-paragraph>
        </s-banner>
      <% end %>
    </s-stack>
  </s-section>

  <%# What's Included %>
  <s-box paddingBlockStart="small">
  <s-section heading="What's Included">
    <s-stack direction="block" gap="base">
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="check-circle-filled" tone="success"></s-icon>
        <s-stack direction="block" gap="extra-tight">
          <s-paragraph><strong>Monitor up to 5 product pages</strong></s-paragraph>
          <s-paragraph>Track critical product pages for silent failures</s-paragraph>
        </s-stack>
      </s-stack>

      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="check-circle-filled" tone="success"></s-icon>
        <s-stack direction="block" gap="extra-tight">
          <s-paragraph><strong>Automated daily scans</strong></s-paragraph>
          <s-paragraph>Automatic health checks for your monitored pages</s-paragraph>
        </s-stack>
      </s-stack>

      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="check-circle-filled" tone="success"></s-icon>
        <s-stack direction="block" gap="extra-tight">
          <s-paragraph><strong>Instant alerts</strong></s-paragraph>
          <s-paragraph>Email and Shopify admin notifications for critical issues</s-paragraph>
        </s-stack>
      </s-stack>

      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="check-circle-filled" tone="success"></s-icon>
        <s-stack direction="block" gap="extra-tight">
          <s-paragraph><strong>Detailed diagnostics</strong></s-paragraph>
          <s-paragraph>Screenshots, console logs, and error tracking</s-paragraph>
        </s-stack>
      </s-stack>
    </s-stack>
  </s-section>
  </s-box>
<% end %>

<%# Billing Management Note %>
<s-box paddingBlockStart="small">
<s-section>
  <s-paragraph>
    <strong>Note:</strong> Billing is managed through your Shopify admin.
    To cancel or modify your subscription, visit your Shopify admin dashboard â†’ Apps section.
  </s-paragraph>
</s-section>
</s-box>
