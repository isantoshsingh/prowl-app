<%# Issue Detail — Polaris Web Components (Built for Shopify) %>

<s-page heading="<%= @issue.title %>">
  <% if @issue.status == "open" %>
  <s-button slot="primary-action" onclick="document.getElementById('acknowledge-form').submit()">Acknowledge</s-button>
  <% end %>
  <s-link slot="breadcrumb-actions" href="<%= issues_path(host: @host) %>">Issues</s-link>
  <s-badge slot="accessory" tone="<%= @issue.status == 'resolved' ? 'success' : (@issue.status == 'acknowledged' ? 'warning' : 'critical') %>"><%= @issue.status.capitalize %></s-badge>
</s-page>

<%= form_with url: acknowledge_issue_path(@issue, host: @host), method: :post, id: "acknowledge-form", style: "display: none;" do %>
<% end %>

<!-- What we detected -->
<s-section heading="What we detected">
  <s-paragraph><%= @issue.description %></s-paragraph>
  <s-box paddingBlockStart="base">
    <s-grid gridTemplateColumns="repeat(4, 1fr)" gap="base">
      <s-stack direction="block" gap="extra-tight">
        <s-paragraph>First Detected</s-paragraph>
        <strong><%= @issue.first_detected_at.strftime("%B %d, %Y at %H:%M") %></strong>
      </s-stack>
      <s-stack direction="block" gap="extra-tight">
        <s-paragraph>Last Detected</s-paragraph>
        <strong><%= @issue.last_detected_at.strftime("%B %d, %Y at %H:%M") %></strong>
      </s-stack>
      <s-stack direction="block" gap="extra-tight">
        <s-paragraph>Occurrence Count</s-paragraph>
        <strong><%= @issue.occurrence_count %> time<%= @issue.occurrence_count > 1 ? 's' : '' %></strong>
      </s-stack>
      <s-stack direction="block" gap="extra-tight">
        <s-paragraph>Issue Type</s-paragraph>
        <strong><%= @issue.issue_type.humanize %></strong>
      </s-stack>
    </s-grid>
  </s-box>
</s-section>

<% if @scan&.screenshot_url.present? %>
<s-box paddingBlockStart="base">
  <s-section heading="Page screenshot">
    <s-box>
      <img
        src="<%= screenshot_path(@scan.id) %>"
        alt="Screenshot when issue was detected"
        style="max-width: 240px; border: 1px solid var(--p-color-border); border-radius: 8px; cursor: pointer;"
        onclick="document.getElementById('screenshot-modal-issue').showOverlay()"
      />
      <s-box paddingBlockStart="tight">
        <s-paragraph>Captured when this issue was detected on <%= @scan.created_at.strftime("%B %d, %Y at %H:%M") %></s-paragraph>
      </s-box>
    </s-box>
  </s-section>
</s-box>

<s-modal id="screenshot-modal-issue" heading="Page Screenshot — <%= @product_page.title %>" size="large" padding="none">
  <s-box padding="none">
    <img
      src="<%= screenshot_path(@scan.id) %>"
      alt="Full screenshot of <%= @product_page.title %>"
      style="width: 100%; display: block;"
    />
  </s-box>
  <s-button slot="secondary-actions" commandFor="screenshot-modal-issue" command="--hide">
    Close
  </s-button>
</s-modal>
<% end %>
<s-box paddingBlockStart="base">
  <s-section heading="Affected product">
    <s-stack direction="block" gap="tight">
      <s-stack direction="inline" gap="tight" align="center">
        <s-link href="<%= product_page_path(@product_page, host: @host) %>"><%= @product_page.title %></s-link>
        <s-paragraph>(<%= @product_page.handle %>)</s-paragraph>
      </s-stack>
      <s-link href="<%= @product_page.scannable_url %>" target="_blank" rel="noopener noreferrer">View product page ↗</s-link>
    </s-stack>
  </s-section>
</s-box>

<s-box paddingBlockStart="base">
  <s-section heading="What you can do">
    <s-stack direction="block" gap="base">
      <% case @issue.issue_type %>
      <% when "missing_add_to_cart" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Visit your product page and try adding to cart yourself</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check if any recently installed apps might be interfering</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Review your theme's product template for errors</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Test with different browsers to rule out browser-specific issues</s-paragraph>
      </s-stack>
      <% when "js_error" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Open your browser's developer console on the product page to see the errors</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check if any recently installed apps are causing JavaScript conflicts</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Try disabling third-party apps one by one to isolate the issue</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Contact your theme developer if the error is in theme code</s-paragraph>
      </s-stack>
      <% when "variant_selector_error" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Test selecting different variants on the product page</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check if all variant options have associated prices and images</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Review any customizations made to the variant selector</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Ensure your product has properly configured variants in Shopify admin</s-paragraph>
      </s-stack>
      <% when "missing_images" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check that all product images are properly uploaded in Shopify admin</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Verify image URLs are accessible (not blocked or expired)</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Look for any CDN or hosting issues</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check your theme settings for image display options</s-paragraph>
      </s-stack>
      <% when "missing_price" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Verify the product has a price set in Shopify admin</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check your theme settings for price display options</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Look for any customizations that might hide prices</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Ensure the currency format is correctly configured</s-paragraph>
      </s-stack>
      <% when "liquid_error" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check your theme's Liquid templates for syntax errors</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Review any recent theme customizations</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Look for missing translation strings</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Contact your theme developer for assistance</s-paragraph>
      </s-stack>
      <% when "slow_page_load" %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Optimize image sizes (compress large product images)</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Review installed apps that might slow down the page</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Consider lazy-loading images below the fold</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Check your theme's performance settings</s-paragraph>
      </s-stack>
      <% else %>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Visit the product page and check for obvious issues</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Try the page in private/incognito mode</s-paragraph>
      </s-stack>
      <s-stack direction="inline" gap="tight" align="start">
        <s-icon type="arrow-right" tone="subdued"></s-icon>
        <s-paragraph>Contact support if the issue persists</s-paragraph>
      </s-stack>
      <% end %>
    </s-stack>
  </s-section>
</s-box>

<% if @issue.evidence.present? %>
<s-box paddingBlockStart="base">
  <s-section heading="Technical details">
    <s-box background="subdued" padding="base" borderRadius="base">
      <pre style="margin: 0; overflow-x: auto; font-size: 12px; white-space: pre-wrap; word-break: break-all;"><%= JSON.pretty_generate(@issue.evidence) rescue @issue.evidence %></pre>
    </s-box>
  </s-section>
</s-box>
<% end %>

<s-box paddingBlockStart="base">
  <s-stack direction="inline" gap="tight" align="center">
    <s-paragraph>Detected in</s-paragraph>
    <s-link href="<%= scan_path(@scan, host: @host) %>">Scan #<%= @scan.id %></s-link>
    <s-paragraph>on <%= @scan.created_at.strftime("%B %d, %Y at %H:%M") %></s-paragraph>
  </s-stack>
</s-box>