<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="shopify-api-key" content="<%= ShopifyApp.configuration.api_key %>" />
    <% application_name = ShopifyApp.configuration.application_name || "PDP Diagnostics" %>
    <title><%= application_name %></title>

    <!-- Shopify App Bridge (CDN - always up to date) -->
    <script src="https://cdn.shopify.com/shopifycloud/app-bridge.js"></script>

    <!-- Shopify Polaris Web Components -->
    <script type="module" src="https://cdn.shopify.com/shopifycloud/web/assets/polaris-web-components.en.min.js"></script>
    <link rel="stylesheet" href="https://cdn.shopify.com/shopifycloud/web/assets/polaris.css" />

    <%= csrf_meta_tags %>

    <style>
      /* Base styles for React app */
      :root {
        --color-success: #008060;
        --color-warning: #b98900;
        --color-critical: #d72c0d;
        --color-text: #202223;
        --color-text-subdued: #6d7175;
        --color-surface: #ffffff;
        --color-background: #f6f6f7;
        --color-border: #e1e3e5;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        padding: 0;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
        background-color: var(--color-background);
        color: var(--color-text);
      }

      #root {
        min-height: 100vh;
      }

      /* Card grid layout */
      .card-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 16px;
      }

      /* Stat card */
      .stat-card {
        background: var(--color-surface);
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      .stat-card__label {
        font-size: 13px;
        color: var(--color-text-subdued);
        margin-bottom: 4px;
      }

      .stat-card__value {
        font-size: 28px;
        font-weight: 600;
      }

      .stat-card__value--success { color: var(--color-success); }
      .stat-card__value--warning { color: var(--color-warning); }
      .stat-card__value--critical { color: var(--color-critical); }

      /* Issue list */
      .issue-list {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .issue-item {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        background: var(--color-surface);
        border-bottom: 1px solid var(--color-border);
        cursor: pointer;
        transition: background-color 0.1s;
      }

      .issue-item:hover {
        background-color: #fafafa;
      }

      .issue-item:last-child {
        border-bottom: none;
      }

      .issue-item__severity {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        flex-shrink: 0;
      }

      .issue-item__severity--high { background-color: var(--color-critical); }
      .issue-item__severity--medium { background-color: var(--color-warning); }
      .issue-item__severity--low { background-color: var(--color-text-subdued); }

      .issue-item__content {
        flex: 1;
        min-width: 0;
      }

      .issue-item__title {
        font-weight: 500;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .issue-item__meta {
        font-size: 12px;
        color: var(--color-text-subdued);
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 40px 20px;
        color: var(--color-text-subdued);
      }

      .empty-state__icon {
        font-size: 48px;
        margin-bottom: 16px;
      }

      .empty-state__title {
        font-size: 16px;
        font-weight: 600;
        color: var(--color-text);
        margin-bottom: 8px;
      }

      .empty-state__description {
        font-size: 14px;
        margin-bottom: 16px;
      }

      /* Status badges */
      .status-badge {
        display: inline-flex;
        align-items: center;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        font-weight: 500;
      }

      .status-badge--healthy {
        background-color: #e3f1df;
        color: var(--color-success);
      }

      .status-badge--warning {
        background-color: #fef3cd;
        color: var(--color-warning);
      }

      .status-badge--critical {
        background-color: #fce9e8;
        color: var(--color-critical);
      }

      .status-badge--pending {
        background-color: #e4e5e7;
        color: var(--color-text-subdued);
      }

      .status-badge--open {
        background-color: #fce9e8;
        color: var(--color-critical);
      }

      .status-badge--acknowledged {
        background-color: #fef3cd;
        color: var(--color-warning);
      }

      .status-badge--resolved {
        background-color: #e3f1df;
        color: var(--color-success);
      }

      /* Data table */
      .data-table {
        width: 100%;
        background: var(--color-surface);
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        border-collapse: collapse;
      }

      .data-table th,
      .data-table td {
        padding: 12px 16px;
        text-align: left;
        border-bottom: 1px solid var(--color-border);
      }

      .data-table th {
        background: var(--color-background);
        font-weight: 500;
        font-size: 13px;
        color: var(--color-text-subdued);
      }

      .data-table tr:last-child td {
        border-bottom: none;
      }

      .data-table tr:hover td {
        background-color: #fafafa;
      }

      /* Loading state */
      .loading {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 40px;
      }

      /* Section spacing */
      .section {
        margin-bottom: 24px;
      }

      .section__header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
      }

      .section__title {
        font-size: 16px;
        font-weight: 600;
        margin: 0;
      }

      /* Detail page */
      .detail-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
      }

      .detail-header__info {
        flex: 1;
      }

      .detail-header__title {
        font-size: 20px;
        font-weight: 600;
        margin: 0 0 8px 0;
      }

      .detail-header__meta {
        font-size: 13px;
        color: var(--color-text-subdued);
      }

      .detail-card {
        background: var(--color-surface);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
      }

      .detail-card__title {
        font-size: 14px;
        font-weight: 600;
        margin: 0 0 12px 0;
        color: var(--color-text);
      }

      /* Form styles */
      .form-group {
        margin-bottom: 16px;
      }

      .form-group__label {
        display: block;
        font-size: 13px;
        font-weight: 500;
        margin-bottom: 4px;
      }

      .form-group__help {
        font-size: 12px;
        color: var(--color-text-subdued);
        margin-top: 4px;
      }

      /* Clickable row */
      .clickable-row {
        cursor: pointer;
      }

      .clickable-row:hover {
        background-color: #f6f6f7;
      }

      /* Technical details */
      .technical-details {
        background: #f4f6f8;
        border-radius: 4px;
        padding: 12px;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        font-size: 12px;
        overflow-x: auto;
        white-space: pre-wrap;
        word-break: break-word;
      }

      /* Flex utilities */
      .flex { display: flex; }
      .flex-1 { flex: 1; }
      .items-center { align-items: center; }
      .justify-between { justify-content: space-between; }
      .gap-2 { gap: 8px; }
      .gap-4 { gap: 16px; }

      /* Spacing utilities */
      .mt-2 { margin-top: 8px; }
      .mt-4 { margin-top: 16px; }
      .mb-2 { margin-bottom: 8px; }
      .mb-4 { margin-bottom: 16px; }
    </style>
  </head>

  <body>
    <div id="root">
      <!-- React app mounts here -->
      <div class="loading">
        <s-spinner size="large" />
      </div>
    </div>

    <!-- Pass data to React app -->
    <script>
      window.__APP_DATA__ = {
        apiKey: '<%= ShopifyApp.configuration.api_key %>',
        host: '<%= @host %>',
        shopOrigin: '<%= @shop&.shopify_domain || current_shopify_domain rescue "" %>'
      };
    </script>

    <!-- React app bundle -->
    <% if Rails.env.development? %>
      <!-- In development, load from Vite dev server -->
      <script type="module">
        import RefreshRuntime from 'http://localhost:3001/@react-refresh'
        RefreshRuntime.injectIntoGlobalHook(window)
        window.$RefreshReg$ = () => {}
        window.$RefreshSig$ = () => (type) => type
        window.__vite_plugin_react_preamble_installed__ = true
      </script>
      <script type="module" src="http://localhost:3001/src/main.jsx"></script>
    <% else %>
      <!-- In production, load built assets -->
      <script type="module" src="/frontend/assets/app.js"></script>
      <link rel="stylesheet" href="/frontend/assets/style.css" />
    <% end %>
  </body>
</html>
